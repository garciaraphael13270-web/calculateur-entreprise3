<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur de R√©cup√©ration</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100">
    <div id="app" class="p-4 md:p-8">
        <div class="max-w-6xl mx-auto">
            <div class="bg-white rounded-xl shadow-lg p-4 md:p-8">
                <!-- En-t√™te -->
                <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
                    <div class="flex items-center gap-3">
                        <img src="data:image/jpeg;base64,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
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <div>
                            <h1 class="text-2xl md:text-3xl font-bold text-slate-800">
                                Calculateur de R√©cup√©ration
                            </h1>
                            <p class="text-sm text-slate-500 mt-1">üíæ Sauvegarde automatique</p>
                        </div>
                    </div>
                    <button
                        onclick="saveData()"
                        class="flex items-center justify-center gap-2 px-6 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors shadow-md font-semibold"
                    >
                        üíæ Sauvegarder
                    </button>
                </div>

                <div id="lastSaved" class="mb-4 p-3 bg-green-50 rounded-lg border border-green-200 text-sm text-green-700 hidden">
                    ‚úì Derni√®re sauvegarde : <span id="saveTime"></span>
                </div>

                <!-- Bar√®me -->
                <div class="mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                    <h2 class="font-semibold text-blue-900 mb-3">üìä Bar√®me des pourcentages :</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-blue-800">
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 bg-blue-400 rounded"></div>
                            <span><strong>Tranche 1 :</strong> 10% de 0 $ √† 25 000 $</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 bg-blue-500 rounded"></div>
                            <span><strong>Tranche 2 :</strong> 20% de 25 001 $ √† 50 000 $</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 bg-blue-600 rounded"></div>
                            <span><strong>Tranche 3 :</strong> 30% de 50 001 $ √† 100 000 $</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 bg-blue-700 rounded"></div>
                            <span><strong>Tranche 4 :</strong> 40% de 100 001 $ et plus</span>
                        </div>
                    </div>
                    <div class="mt-3 p-2 bg-amber-50 border border-amber-200 rounded text-xs text-amber-800">
                        ‚ÑπÔ∏è Le pourcentage s'applique sur le montant TOTAL selon la tranche o√π il se trouve
                    </div>
                </div>

                <!-- Ajouter entreprise -->
                <div class="mb-6 p-4 bg-slate-50 rounded-lg border border-slate-200">
                    <h3 class="font-semibold text-slate-700 mb-3">‚ûï Ajouter une entreprise</h3>
                    <div class="flex gap-2">
                        <input
                            type="text"
                            id="newCompanyInput"
                            placeholder="Nom de l'entreprise"
                            class="flex-1 px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-emerald-500"
                            onkeypress="if(event.key === 'Enter') addCompany()"
                        />
                        <button
                            onclick="addCompany()"
                            class="flex items-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-md hover:bg-emerald-700 transition-colors"
                        >
                            ‚ûï Ajouter
                        </button>
                    </div>
                </div>

                <!-- Tableau -->
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-slate-100">
                                <th class="border border-slate-300 px-4 py-3 text-left font-semibold text-slate-700">Entreprise</th>
                                <th class="border border-slate-300 px-4 py-3 text-left font-semibold text-slate-700">Montant ($)</th>
                                <th class="border border-slate-300 px-4 py-3 text-left font-semibold text-slate-700">Tranche</th>
                                <th class="border border-slate-300 px-4 py-3 text-left font-semibold text-slate-700">√Ä r√©cup√©rer</th>
                                <th class="border border-slate-300 px-4 py-3 text-center font-semibold text-slate-700 w-20">Action</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                        </tbody>
                        <tfoot>
                            <tr class="bg-emerald-50">
                                <td colspan="3" class="border border-slate-300 px-4 py-4 text-right font-bold text-slate-800 text-lg">
                                    TOTAL √Ä R√âCUP√âRER :
                                </td>
                                <td colspan="2" class="border border-slate-300 px-4 py-4 font-bold text-emerald-700 text-lg">
                                    <span id="totalAmount">0,00 $US</span>
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <div class="mt-6 p-4 bg-slate-50 rounded-lg">
                    <p class="text-sm text-slate-600">
                        üí° <strong>Exemple :</strong> Pour 60 000 $ (Tranche 3), vous r√©cup√©rez 60 000 √ó 30% = 18 000 $
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const initialCompanies = [
            "Pearl's", "Stock Buck", "Beeker's Garage", "Bahama's",
            "Luchetti's", "LTD Sud", "LTD Mirror Park", "Gruppe6"
        ];

        let companies = [...initialCompanies];
        let amounts = {};

        // Initialiser les montants
        companies.forEach(c => amounts[c] = '');

        function calculateRecovery(amount) {
            const num = parseFloat(amount) || 0;
            let percentage = 0;
            let tranche = '';

            if (num === 0) {
                return { amount: 0, percentage: 0, tranche: '-' };
            } else if (num <= 25000) {
                percentage = 0.10;
                tranche = 'T1 (10%)';
            } else if (num <= 50000) {
                percentage = 0.20;
                tranche = 'T2 (20%)';
            } else if (num <= 100000) {
                percentage = 0.30;
                tranche = 'T3 (30%)';
            } else {
                percentage = 0.40;
                tranche = 'T4 (40%)';
            }

            return {
                amount: num * percentage,
                percentage: percentage * 100,
                tranche: tranche
            };
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('fr-FR', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2
            }).format(value);
        }

        function updateTotal() {
            let total = 0;
            companies.forEach(company => {
                const recovery = calculateRecovery(amounts[company]);
                total += recovery.amount;
            });
            document.getElementById('totalAmount').textContent = formatCurrency(total);
        }

        function renderTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            companies.forEach((company, index) => {
                const recovery = calculateRecovery(amounts[company]);
                const row = document.createElement('tr');
                row.className = 'hover:bg-slate-50 transition-colors';
                row.innerHTML = `
                    <td class="border border-slate-300 px-4 py-3 font-medium text-slate-700">${company}</td>
                    <td class="border border-slate-300 px-4 py-3">
                        <input
                            type="number"
                            id="amount_${index}"
                            value="${amounts[company]}"
                            placeholder="0"
                            class="w-full px-3 py-2 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-emerald-500"
                            min="0"
                            step="0.01"
                        />
                    </td>
                    <td class="border border-slate-300 px-4 py-3 font-semibold text-blue-700" id="tranche_${index}">
                        ${recovery.tranche}
                    </td>
                    <td class="border border-slate-300 px-4 py-3 font-semibold text-emerald-700" id="recovery_${index}">
                        ${formatCurrency(recovery.amount)}
                    </td>
                    <td class="border border-slate-300 px-4 py-3 text-center">
                        <button
                            onclick="removeCompany(${index})"
                            class="p-2 text-red-600 hover:bg-red-50 rounded transition-colors"
                            title="Supprimer"
                        >
                            üóëÔ∏è
                        </button>
                    </td>
                `;
                tbody.appendChild(row);

                // Ajouter l'√©v√©nement apr√®s l'insertion dans le DOM
                document.getElementById(`amount_${index}`).addEventListener('input', function(e) {
                    amounts[company] = e.target.value;
                    const recovery = calculateRecovery(e.target.value);
                    document.getElementById(`tranche_${index}`).textContent = recovery.tranche;
                    document.getElementById(`recovery_${index}`).textContent = formatCurrency(recovery.amount);
                    updateTotal();
                });
            });

            updateTotal();
        }

        function addCompany() {
            const input = document.getElementById('newCompanyInput');
            const name = input.value.trim();
            
            if (name && !companies.includes(name)) {
                companies.push(name);
                amounts[name] = '';
                input.value = '';
                renderTable();
            }
        }

        function removeCompany(index) {
            const company = companies[index];
            companies.splice(index, 1);
            delete amounts[company];
            renderTable();
        }

        function saveData() {
            try {
                localStorage.setItem('recovery_companies', JSON.stringify(companies));
                localStorage.setItem('recovery_amounts', JSON.stringify(amounts));
                const now = new Date().toLocaleString('fr-FR');
                localStorage.setItem('recovery_last_saved', now);
                
                document.getElementById('saveTime').textContent = now;
                document.getElementById('lastSaved').classList.remove('hidden');
                
                alert('‚úÖ Donn√©es sauvegard√©es avec succ√®s !');
            } catch (error) {
                alert('‚ùå Erreur lors de la sauvegarde');
            }
        }

        function loadData() {
            try {
                const savedCompanies = localStorage.getItem('recovery_companies');
                const savedAmounts = localStorage.getItem('recovery_amounts');
                const savedTime = localStorage.getItem('recovery_last_saved');

                if (savedCompanies) {
                    companies = JSON.parse(savedCompanies);
                }
                if (savedAmounts) {
                    amounts = JSON.parse(savedAmounts);
                }
                if (savedTime) {
                    document.getElementById('saveTime').textContent = savedTime;
                    document.getElementById('lastSaved').classList.remove('hidden');
                }
            } catch (error) {
                console.log('Premi√®re utilisation');
            }
            renderTable();
        }

        // Charger les donn√©es au d√©marrage
        loadData();
    </script>
</body>
</html>

